#include "transmitter.h"
#include <stdio.h>

#define N 256
#define sps 100

int main() {
    // bits to send
    const int key[45] = {1, 1, 1, -1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, 1,
                     1, 1, 1, -1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, 1,
                     1, 1, 1, -1, -1, -1, 1, -1, -1, 1, 1, -1, 1, -1, 1};
    const int bit_key[45] = {1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,
                     1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,
                     1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1};
    int bits[N] = {0,1,0,0,1,0,0,1,0,0,
                   1,0,0,0,0,0,0,1,1,0,
                   0,1,0,0,0,1,1,0,1,1,
                   1,1,0,1,1,0,1,1,1,0,
                   0,0,1,0,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,1,1,0,1,1,1,
        0,1,1,1,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,1,0,1,1,0,1,1,1,1,0,1,1,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
        1,1,0,1,0,0,0,1,1,0,0,1,0,1,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,
        0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,0,0,1,1,0,0,1,0,1,0,1,1,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,0,0,1,
        0,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1}; // length 256

    int key_w_bits[N+45] = {1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,
                     1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1,
                     1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0,1,0,0,1,0,0,1,0,0,
                   1,0,0,0,0,0,0,1,1,0,
                   0,1,0,0,0,1,1,0,1,1,
                   1,1,0,1,1,0,1,1,1,0,
                   0,0,1,0,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,0,1,1,0,1,1,0,1,1,1,0,0,1,1,0,1,1,1,1,0,1,1,1,
        0,1,1,1,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,1,0,1,1,0,1,1,1,1,0,1,1,1,0,1,0,1,0,0,1,0,0,0,0,0,0,1,
        1,1,0,1,0,0,0,1,1,0,0,1,0,1,0,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,
        0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,0,0,1,1,0,0,1,0,1,0,1,1,0,0,1,1,1,0,1,1,0,0,1,1,1,0,1,1,0,0,1,
        0,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,0,0,0,0,1,0,0,0,0,1};
    float fc = 1000000; // carrier frequency
    float Fs = 1000000; // sampling frequency
    float F = fc/Fs;

    uint16_t output[(N+45)*sps];
    
    transmit(output, key_w_bits, F, 0);

    FILE *fpt = fopen("MyFile.csv", "w+");
    int i = 0;
    for (; i < N*sps; i++) {
        fprintf(fpt, "%u,", output[i]);
    }
    fclose(fpt);
}